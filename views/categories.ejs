<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Categories - Inventory Management</title>
    <link rel="stylesheet" href="/css/app.css" />
  </head>
  <body class="auth-body">
    <div class="auth-wrapper">
      <div class="auth-card">
        <header class="auth-header">
          <h1>Product Categories</h1>
          <p>Manage your product categories (<%= categories.length %> total)</p>
        </header>

        <div class="dashboard-actions right">
          <a href="/categories/add" class="auth-btn">Add Category</a>
        </div>

        <div class="dashboard-section">
          <% if (categories && categories.length > 0) { %>

          <!-- MOBILE CARD VIEW (Hidden on desktop) -->
          <div class="mobile-category-view">
            <% categories.forEach((category, index) => { %>
            <div class="mobile-category-card">
              <div
                style="
                  display: flex;
                  align-items: center;
                  gap: 10px;
                  margin-bottom: 8px;
                "
              >
                <span class="id-pill"><%= index + 1 %></span>
                <h3 class="mobile-category-name" style="margin: 0; flex: 1">
                  <%= category.name %>
                </h3>
              </div>

              <p class="mobile-category-description">
                <%= category.description || 'No description' %>
              </p>

              <div class="mobile-category-meta">
                <div class="mobile-category-meta-item">
                  <span class="mobile-category-meta-label">Products</span>
                  <span class="mobile-category-meta-value"
                    ><%= category.product_count %></span
                  >
                </div>
                <div class="mobile-category-meta-item">
                  <span class="mobile-category-meta-label">Created</span>
                  <span
                    class="mobile-category-meta-value"
                    style="font-size: 0.8rem"
                  >
                    <%= new Date(category.created_at).toLocaleDateString() %>
                  </span>
                </div>
              </div>

              <div class="mobile-category-actions">
                <% if (category.name !== 'Uncategorized') { %>
                <a
                  href="/categories/edit/<%= category.id %>"
                  class="table-btn"
                  style="flex: 1"
                >
                  Edit
                </a>
                <form
                  action="/categories/delete/<%= category.id %>"
                  method="POST"
                  class="delete-form"
                  data-name="<%= category.name %>"
                  style="flex: 1"
                >
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                  <button
                    type="submit"
                    class="table-btn table-btn-danger"
                    style="width: 100%"
                  >
                    Delete
                  </button>
                </form>
                <% } else { %>
                <span
                  class="table-btn"
                  style="
                    opacity: 0.3;
                    cursor: not-allowed;
                    flex: 1;
                    text-align: center;
                  "
                >
                  Protected
                </span>
                <% } %>
              </div>
            </div>
            <% }) %>
          </div>

          <!-- DESKTOP TABLE VIEW (Hidden on mobile) -->
          <div class="products-container desktop-table-view">
            <table class="products-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Products</th>
                  <th>Created</th>
                  <th>Edit</th>
                  <th>Delete</th>
                </tr>
              </thead>
              <tbody>
                <% categories.forEach((category, index) => { %>
                <tr>
                  <td class="id-cell">
                    <span class="id-pill"><%= index + 1 %></span>
                  </td>
                  <td><strong><%= category.name %></strong></td>
                  <td><%= category.description || 'No description' %></td>
                  <td style="text-align: center">
                    <span class="stock-badge"
                      ><%= category.product_count %></span
                    >
                  </td>
                  <td>
                    <%= new Date(category.created_at).toLocaleDateString() %>
                  </td>
                  <td class="table-actions">
                    <% if (category.name !== 'Uncategorized') { %>
                    <a
                      href="/categories/edit/<%= category.id %>"
                      class="table-btn"
                    >
                      Edit
                    </a>
                    <% } else { %>
                    <span
                      class="table-btn"
                      style="opacity: 0.3; cursor: not-allowed"
                    >
                      Edit
                    </span>
                    <% } %>
                  </td>
                  <td class="table-actions">
                    <% if (category.name !== 'Uncategorized') { %>
                    <form
                      action="/categories/delete/<%= category.id %>"
                      method="POST"
                      class="delete-form"
                      data-name="<%= category.name %>"
                    >
                      <input
                        type="hidden"
                        name="_csrf"
                        value="<%= csrfToken %>"
                      />
                      <button type="submit" class="table-btn table-btn-danger">
                        Delete
                      </button>
                    </form>
                    <% } else { %>
                    <span
                      class="table-btn"
                      style="opacity: 0.3; cursor: not-allowed"
                    >
                      Delete
                    </span>
                    <% } %>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
          <% } else { %>
          <p class="no-products">No categories found.</p>
          <% } %>
        </div>

        <footer class="auth-footer footer-actions">
          <a href="/dashboard" class="auth-btn btn-ghost w-auto"
            >Back to Dashboard</a
          >
        </footer>
      </div>
    </div>
    <script src="/js/app.js"></script>
  </body>
</html>
