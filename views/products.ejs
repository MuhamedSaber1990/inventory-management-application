<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Products</title>
    <link rel="stylesheet" href="/css/app.css" />
  </head>

  <body class="auth-body">
    <div class="auth-wrapper">
      <div class="auth-card">
        <header class="auth-header">
          <h1>Products List</h1>
          <p>Your inventory items</p>
        </header>

        <div class="dashboard-actions right">
          <a href="/products/add" class="auth-btn">Add Product</a>
        </div>

        <!-- Items Per Page -->
        <form action="/products" method="GET" id="limitForm" class="limit-controls">
  <label for="limit" class="limit-label">Items per page:</label>
  <input type="hidden" name="page" value="1">
  
  <!-- REMOVED onchange="document..." -->
  <!-- prettier-ignore -->
  <select name="limit" id="limit" class="limit-select"> 
    <option value="10" <%= currentLimit === 10 ? 'selected' : '' %>>10</option>
    <option value="20" <%= currentLimit === 20 ? 'selected' : '' %>>20</option>
    <option value="40" <%= currentLimit === 40 ? 'selected' : '' %>>40</option>
    <option value="80" <%= currentLimit === 80 ? 'selected' : '' %>>80</option>
  </select>
</form>

        <div class="dashboard-section">
          <% if (products && products.length > 0) { %>

            <div class="products-container">
              <table class="products-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>SKU</th>
                    <th>Price (â‚¬)</th>
                    <th>Quantity</th>
                    <th>Description</th>
                    <th>Update</th>
                    <th>Delete</th>
                  </tr>
                </thead>

                <tbody>
                  <% products.forEach((product, index) => { %>
                    <tr>
                      <!-- Centered pill ID -->
                      <td class="id-cell">
                        <span class="id-pill">
                          <%= ((currentPage - 1) * currentLimit) + index + 1 %>
                        </span>
                      </td>

                      <td><%= product.name %></td>
                      <td><%= product.sku %></td>
                      <td><%= product.price %></td>
                      <td><%= product.quantity %></td>
                      <td><%= product.description %></td>

                      <td class="table-actions">
                        <a href="/products/edit/<%= product.id %>" class="table-btn">Update</a>
                      </td>

                      <td class="table-actions">
                        <form
                          action="/products/delete/<%= product.id %>"
                          method="POST"
                          class="delete-form"
                          data-name="<%= product.name %>"
                        >
                          <input type="hidden" name="_csrf" value="<%= csrfToken %>" />

                          <button type="submit" class="table-btn table-btn-danger">
                            Delete
                          </button>
                        </form>
                      </td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>

          <% } else { %>
            <p class="no-products">No products available.</p>
          <% } %>
        </div>

        <!-- Pagination -->
        <% if (totalPages > 1) { %>
          <div class="pagination-wrapper">

            <!-- Previous -->
            <% if (currentPage > 1) { %>
              <a
                href="/products?page=<%= currentPage - 1 %>&limit=<%= currentLimit %>"
                class="page-link"
              >
                &larr; Previous
              </a>
            <% } else { %>
              <span class="page-link disabled">&larr; Previous</span>
            <% } %>

            <!-- Page numbers -->
            <% for (let i = 1; i <= totalPages; i++) { %>
              <a
                href="/products?page=<%= i %>&limit=<%= currentLimit %>"
                class="page-link <%= currentPage === i ? 'active' : '' %>"
              >
                <%= i %>
              </a>
            <% } %>

            <!-- Next -->
            <% if (currentPage < totalPages) { %>
              <a
                href="/products?page=<%= currentPage + 1 %>&limit=<%= currentLimit %>"
                class="page-link"
              >
                Next &rarr;
              </a>
            <% } else { %>
              <span class="page-link disabled">Next &rarr;</span>
            <% } %>

          </div>
        <% } %>

        <footer class="auth-footer footer-actions">
          <a href="/dashboard" class="auth-btn">Back to Dashboard</a>
        </footer>
      </div>
    </div>

    <script src="/js/app.js"></script>
  </body>
</html>
