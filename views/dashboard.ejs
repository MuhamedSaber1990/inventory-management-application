<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/app.css" />
  </head>
  <body class="auth-body">
    <div class="auth-wrapper">
      <div class="auth-card">
        <!-- HEADER -->
        <header class="auth-header">
          <h1>Welcome, <%= user.name %></h1>
          <p>Inventory Overview</p>
        </header>

        <!-- 1. STATS GRID -->
        <div class="stats-grid">
          <!-- Card 1: Total Products -->
          <div class="stat-card">
            <span class="stat-label">Total Products</span>
            <span class="stat-value"><%= stats.total_items %></span>
          </div>

          <!-- Card 2: Total Value -->
          <div class="stat-card money">
            <span class="stat-label">Total Value</span>
            <span class="stat-value">
              €<%= Number(stats.total_value).toLocaleString('en-EU', {
              minimumFractionDigits: 2 }) %>
            </span>
          </div>

          <!-- Card 3: Low Stock Alert -->
          <div
            class="stat-card <%= stats.low_stock_count > 0 ? 'alert' : '' %>"
          >
            <span class="stat-label">Low Stock Items</span>
            <span class="stat-value"><%= stats.low_stock_count %></span>
          </div>
        </div>

        <!-- 2. MAIN ACTIONS -->
        <div class="dashboard-actions">
          <a href="/products" class="auth-btn">Manage All Products</a>
          <a href="/categories" class="auth-btn">Manage Categories</a>
          <form action="/logout" method="POST" style="display: inline">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
            <button
              type="submit"
              class="auth-btn"
              style="
                background: transparent;
                border: 1px solid var(--border-subtle);
              "
            >
              Logout
            </button>
          </form>
        </div>

        <!-- 3. DATA MANAGEMENT SECTION -->
        <div class="dashboard-section">
          <div class="section-header">
            <h2>Data Management</h2>
          </div>

          <div class="stats-grid">
            <!-- Export CSV -->
            <a href="/data/export/products/csv" class="stat-card">
              <span class="stat-label">Export CSV</span>
              <span class="stat-value">Text File</span>
            </a>

            <!-- Import CSV -->
            <a href="/data/import" class="stat-card">
              <span class="stat-label">Import</span>
              <span class="stat-value">Upload</span>
            </a>

            <!-- Backup DB -->
            <a href="/data/backup/database" class="stat-card alert">
              <span class="stat-label">Backup</span>
              <span class="stat-value">SQL Dump</span>
            </a>
          </div>
        </div>

        <!-- 4. LOW STOCK ALERTS SECTION -->
        <% if (lowStockProducts.length > 0) { %>
        <div class="dashboard-section">
          <div class="section-header">
            <h2>⚠️ Low Stock Alerts</h2>
          </div>

          <table class="mini-table">
            <tbody>
              <% lowStockProducts.forEach(product => { %>
              <tr>
                <td><%= product.name %></td>
                <td style="text-align: right">
                  <span class="stock-badge"><%= product.quantity %> left</span>
                </td>
                <td style="text-align: right; width: 80px">
                  <a
                    href="/products/edit/<%= product.id %>"
                    class="auth-link-small"
                    >Refill</a
                  >
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
        <% } %>
      </div>
    </div>
  </body>
</html>
